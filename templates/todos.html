<div class="max-w-xl mx-auto bg-white p-6 rounded-lg shadow-md">
    <h3 class="text-2xl font-bold mb-4">✅ Your Todo List</h3>

    <!-- Add Todo Form -->
    <form id="add-todo-form" class="flex mb-4">
        <input type="text" id="new-todo" name="title" placeholder="Add a new task"
               class="flex-grow px-4 py-2 border rounded-l focus:outline-none focus:ring-2 focus:ring-indigo-400">
        <button type="submit" class="px-4 py-2 bg-indigo-500 text-white rounded-r hover:bg-indigo-600">Add</button>
    </form>

    <!-- Todo items -->
    <ul id="todo-list" class="space-y-2">
        {% for todo in todos %}
        <li class="flex items-center justify-between bg-gray-50 px-4 py-2 rounded shadow-sm" data-id="{{ todo.id }}">
            <div class="flex items-center gap-2">
                <input type="checkbox" data-id="{{ todo.id }}" class="todo-checkbox" {% if todo.completed %}checked{% endif %}>
                <span class="{% if todo.completed %}line-through text-gray-400{% endif %}">{{ todo.title }}</span>
            </div>
            <button class="delete-btn text-red-500 hover:text-red-700">Delete</button>
        </li>
        {% empty %}
        <li class="text-gray-500">No tasks yet. Add something above!</li>
        {% endfor %}
    </ul>
</div>


<script>
document.addEventListener('DOMContentLoaded', function() {

    const addForm = document.getElementById('add-todo-form');
    const todoList = document.getElementById('todo-list');

    // 1️⃣ Add Todo instantly
    addForm.addEventListener('submit', function(e) {
        e.preventDefault(); // Prevent page reload

        const titleInput = document.getElementById('new-todo');
        const title = titleInput.value.trim();
        if (!title) return;

        fetch('api/add-todo/', {
            method: 'POST',
            headers: {
                'X-CSRFToken': '{{ csrf_token }}',
                'X-Requested-With': 'XMLHttpRequest',
                'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: 'title=' + encodeURIComponent(title)
        })
        .then(response => response.json())
        .then(data => {
            if (data.id) {
                // Clear input
                titleInput.value = '';

                // Add new todo to UI
                const li = document.createElement('li');
                li.className = "flex items-center justify-between bg-gray-50 px-4 py-2 rounded shadow-sm";
                li.dataset.id = data.id;
                li.innerHTML = `
                    <div class="flex items-center gap-2">
                        <input type="checkbox" data-id="${data.id}" class="todo-checkbox">
                        <span>${data.title}</span>
                    </div>
                    <button class="delete-btn text-red-500 hover:text-red-700">Delete</button>
                `;
                todoList.prepend(li);
            }
        });
    });

    // 2️⃣ Toggle and delete using event delegation
    todoList.addEventListener('click', function(e) {
        const li = e.target.closest('li');
        if (!li) return;
        const todoId = li.dataset.id;

        // Toggle completed
        if (e.target.classList.contains('todo-checkbox')) {
            fetch(`api/toggle-todo/${todoId}/`, {
                method: 'POST',
                headers: {
                    'X-CSRFToken': '{{ csrf_token }}',
                    'X-Requested-With': 'XMLHttpRequest',
                }
            }).then(() => {
                const span = e.target.nextElementSibling;
                span.classList.toggle('line-through');
                span.classList.toggle('text-gray-400');
            });
        }

        // Delete todo
        if (e.target.classList.contains('delete-btn')) {
            fetch(`api/delete-todo/${todoId}/`, {
                method: 'POST',
                headers: {
                    'X-CSRFToken': '{{ csrf_token }}',
                    'X-Requested-With': 'XMLHttpRequest',
                }
            }).then(() => li.remove());
        }
    });

});
</script>


